<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test player viewinfo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
            window.jQuery = window.$ = require("jquery");
    </script>
    <script src="../node_modules/riot/riot+compiler.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../app/css/app.css">

    <style type="text/css">
        .test-button{
            height: 25px;
        }
        .test-player-viewinfo-page{
            height: calc(100% - 25px);
        }
    </style>

</head>

<body>
    <div class="test-button">
        <button type="button" onclick="onclickLoad();">load</button>
        <button type="button" onclick="onclickLoad2();">load comment</button>
        <button type="button" onclick="onclickLoad3();">watch dmc</button>
        <button type="button" onclick="onclickLoad4();">watch smile</button>
    </div>    
    <player-viewinfo-page ref="pvi" class="test-player-viewinfo-page"></player-viewinfo-page>
</body>

<script>
    const path = require("path");
    const fs = require("fs");
    const remote = require("electron").remote;
    const shared_obj = remote.getGlobal("sharedObj");
    var app_base_dir = shared_obj.base_dir;  // eslint-disable-line
    const test_dir = path.join(path.resolve(app_base_dir, ".."), "test");

    var riot = require("riot");  // eslint-disable-line
    var obs = riot.observable(); // eslint-disable-line
    
    const reader = require(`${app_base_dir}/js/reader`);
    require(`${app_base_dir}/tags/player-viewinfo-page`);
    riot.mount("player-viewinfo-page");    

    const onclickLoad = () => {
        const comment_path = `${test_dir}/data/test1-comment.xml`;
        const xml = fs.readFileSync(comment_path, "utf-8");
        const commnets = reader.comment(xml);
        const video_data = {
            src: `${test_dir}/data/test1.mp4`,
            type: "video/mp4",
            commnets: commnets
        };
        const viweinfo = {
            thumb_info: {
                video_id: "sm100000",
                title: "test sm100000",
                description: "前：<a href=\"https://www.nicovideo.jp/watch/sm10\" class=\"watch\">sm10</a>"
                            + "------------------動画-------------------- <br>"
                            + "---<br>--<br>--<br><br>----<br>---<br>--<br>--",          
                thumbnail_url: `${test_dir}/data/sample.jpeg`, //130x100
                first_retrieve: "2017-07-07T18:30:00+09:00",
                length: "10:00",
                video_type: "mp4",
                size_high: 1000000,
                size_low: 2000000,
                view_counter: 1000,
                comment_num: 2000,
                mylist_counter: 100,
                last_res_body: "test",
                watch_url: "http://www.nicovideo.jp/watch/sm100000",
                thumb_type: "video",
                embeddable: 1,
                no_live_play: 0,
                tags: [            
                    { text: "タグ1", lock: true },
                    { text: "タグ2", lock: true },
                    { text: "タグ3", lock: false }
                ],
                user_id: "1234567",
                user_nickname: "abcdefg",
                user_icon_url: `${test_dir}/data/user_icon.jpg` //50x50
            },
            commnets: commnets
        };
        
        obs.trigger("request-send-video-data", {video_data, viweinfo}); 
    };
    const onclickLoad2 = () => {
        let commnets = [];
        const nn = 5000;
        for (let index = 0; index < nn; index++) {
            commnets.push({
                no: index + 1,
                vpos: 50 * index,
                post_date: 1332592373506 + index*100,
                user_id: "AAA",
                mail: "ue",
                text: "------------------text1------------------------"
            });
        }
        obs.trigger("on_change_viweinfo",{
            thumb_info: {
                video_id: "sm100000",
                title: "test sm100000",
                description: "--------- ---------動画----- ---------------",
                thumbnail_url: `${test_dir}/data/sample.jpeg`, //130x100
                first_retrieve: "2017-07-07T18:30:00+09:00",
                length: "10:00",
                video_type: "mp4",
                size_high: 1000000,
                size_low: 2000000,
                view_counter: 1000,
                comment_num: 2000,
                mylist_counter: 100,
                last_res_body: "test",
                watch_url: "http://www.nicovideo.jp/watch/sm100000",
                thumb_type: "video",
                embeddable: 1,
                no_live_play: 0,
                tags: [            
                    { text: "タグ1", lock: true },
                    { text: "タグ2", lock: true }
                ],
                user_id: "1234567",
                user_nickname: "abcdefg",
                user_icon_url: `${test_dir}/data/user_icon.jpg` //50x50
            },
            commnets: commnets
        }); 
    };

    const onclickLoad3 = () => {
        const video_id = "sm33851481"; //"sm32951089";
        obs.trigger("request-send-videoid", video_id); 
    };
    const onclickLoad4 = () => {
        const video_id = "sm29316071";
        obs.trigger("request-send-videoid", video_id); 
    };
</script>

</html>
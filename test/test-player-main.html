<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test player viewinfo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../app/css/app.css">

    <style type="text/css">
        .debug-btn1{
            position: absolute;
            width: 100px;
            height: 25px;
            top: 0px;
            z-index: 10;
        } 
        .debug-btn2{
            position: absolute;
            width: 100px;
            height: 25px;
            top: 0px;
            left: 100px;
            z-index: 10;
        }  
        .debug-btn3{
            position: absolute;
            width: 100px;
            height: 25px;
            top: 0px;
            left: 200px;
            z-index: 10;
        }          
        .debug-player-main-page{
            position: absolute;
            top: 0px;
            width: 100vw;
        }
    </style>

</head>

<body>
    <div>
        <button class="debug-btn1" type="button" onclick="onclickLoad();">load</button>
        <button class="debug-btn2" type="button" onclick="onclickLoad2();">load comment</button>
        <button class="debug-btn3" type="button" onclick="onclickLoad3();">online sm20</button>
    </div>    
    <player-main-page ref="pvi" class="debug-player-main-page"></player-main-page>
</body>

<script src="../node_modules/riot/riot+compiler.min.js"></script>
<script type="riot/tag" src="../app/tags/player-main-page.tag"></script>
<script type="riot/tag" src="../app/tags/modal-dialog.tag"></script>
<script type="riot/tag" src="../app/tags/player-tags.tag"></script>
<script type="riot/tag" src="../app/tags/player-seek.tag"></script>
<script type="riot/tag" src="../app/tags/player-volume.tag"></script>
<script type="riot/tag" src="../app/tags/player-controls.tag"></script>
<script type="riot/tag" src="../app/tags/player-video.tag"></script>
<script type="riot/tag" src="../app/tags/player-page.tag"></script>
<script type="riot/tag" src="../app/tags/player-viewinfo-page.tag"></script>
<script type="riot/tag" src="../app/tags/comment-setting-dialog.tag"></script>
<script type="riot/tag" src="../app/tags/comment-ng-setting.tag"></script>
<script type="riot/tag" src="../app/tags/comment-display-setting.tag"></script>
<script type="riot/tag" src="../app/tags/open-video-form.tag"></script>
<script>
    /* globals riot */
    const fs = window.fs;
    const test_dir = window.getPathFromRoot(["test"]);
    const { ipcRenderer } = window.electron;
    const { IPC_CHANNEL } = window.IPC_CHANNEL;
    const { DataIpcRenderer } = window.DataIpc;
    const { NicoVideoMocks } = window.NicoMock;
    const reader = window.reader;

    const video_mocks = [];
    const video_ids = ["sm10", "sm20", "sm30", "sm40", "sm50"];
    video_ids.forEach(video_id => {
        const video_mock = new NicoVideoMocks(video_id);
        video_mock.watch();
        video_mock.comment();
        video_mock.dmc_session();
        video_mock.dmc_hb();
        video_mocks.push(video_mock);
    });

    const obs = riot.observable(); // eslint-disable-line
    riot.mount("player-main-page", {obs});

    DataIpcRenderer.action("config", "get", { key:"data_dir", value:"" }).then((data_dir)=>{
        DataIpcRenderer.action("library", "setData", {
            data_dir : data_dir, 
            path_data_list : [{id:"0", dirpath:"dir1"},{id:"1", dirpath:"dir2"}],
            video_data_list : [{id:"sm1", dirpath_id:"0"},{id:"sm20", dirpath_id:"1"}]
        }).then(()=>{});
    });

    const onclickLoad = () => {
        const comment_path = `${test_dir}/data/test1-comment.xml`;
        const xml = fs.readFileSync(comment_path, "utf-8");
        const comments = reader.comment(xml);
        const video_data = {
            src: `${test_dir}/data/test1.mp4`,
            type: "video/mp4",
            comments: comments
        };
        const viewinfo = {
            is_deleted: true,
            thumb_info: {
                video: {
                    video_id: "sm100000",
                    title: "test sm100000",
                    description: "前：<a href=\"https://www.nicovideo.jp/watch/sm10\" class=\"watch\">sm10</a>"
                            + "------------------動画-------------------- <br>"
                            + "---<br>--<br>--<br><br>----<br>---<br>--<br>--",
                    thumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    largeThumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    postedDateTime: "2017-07-07T18:30:00+09:00",
                    duration: "10:00",
                    viewCount: 1000, 
                    mylistCount: 100, 
                    video_type: "mp4",
                },
                thread: {
                    commentCount: 2000
                },
                tags: [
                    { id: 1, name: "タグ1", isLocked: true },
                    { id: 2, name: "タグ2", isLocked: true },
                    { id: 3, name: "タグ3", isLocked: false }
                ],
                owner: {
                    id: "1234567",
                    nickname: "abcdefg",
                    iconURL: `${test_dir}/data/user_icon.jpg` //50x50
                }
            },
        };
        const state = {
            is_online: false,
            is_saved: true
        };
        obs.trigger("player-main-page:test-play-by-data", 
            {video_data, viewinfo, comments, state}); 
    };
    const onclickLoad2 = () => {
        let comments = [];
        const nn = 5000;
        for (let index = 0; index < nn; index++) {
            comments.push({
                no: index + 1,
                vpos: 50 * index,
                post_date: 1332592373506 + index*100,
                user_id: "AAA",
                mail: "ue",
                content: "------------------text1------------------------"
            });
        }
        const viewinfo = {
            is_deleted: false,
            thumb_info: {
                video: {
                    video_id: "sm100000",
                    title: "test sm100000",
                    description: "--------- ---------動画----- ---------------",
                    thumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    largeThumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    postedDateTime: "2017-07-07T18:30:00+09:00",
                    duration: "10:00",
                    viewCount: 1000, 
                    mylistCount: 100, 
                    video_type: "mp4",
                },
                thread: {
                    commentCount: 2000
                },
                tags: [
                    { id: 1, name: "タグ1", isLocked: true },
                    { id: 2, name: "タグ2", isLocked: true },
                ],
                owner: {
                    id: "1234567",
                    nickname: "abcdefg",
                    iconURL: `${test_dir}/data/user_icon.jpg` //50x50
                }
            }
        };         
        const state = {
            is_online: true,
            is_saved: false
        };
        obs.trigger("player-viewinfo-page:set-viewinfo-data",
            { viewinfo, comments, state });
    };
    const onclickLoad3 = () => {
        ipcRenderer.send(IPC_CHANNEL.PLAY_BY_VIDEO_ONLINE, {
            video_id: "sm20",
            time: 0
        });
    };
</script>

</html>
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Hello World!</title>
        <link rel="stylesheet" type="text/css" href="../css/app.css">
        <link rel="stylesheet" type="text/css" href="../css/split-page.css">
        <style type="text/css">
        </style>
    </head>

    <body>
        <window-titlebar></window-titlebar>
        <main-page></main-page>
    </body>
    <script src="../../node_modules/riot/riot+compiler.min.js"></script>
    <script type="riot/tag" src="../tags/main-page.tag"></script>
    <script type="riot/tag" src="../tags/listview.tag"></script>
    <script type="riot/tag" src="../tags/pagination.tag"></script>
    <script type="riot/tag" src="../tags/modal-dialog.tag"></script>
    <script type="riot/tag" src="../tags/library-page.tag"></script>
    <script type="riot/tag" src="../tags/search-page.tag"></script>
    <script type="riot/tag" src="../tags/download-schedule-dialog.tag"></script>
    <script type="riot/tag" src="../tags/download-page.tag"></script>
    <script type="riot/tag" src="../tags/play-history-page.tag"></script>
    <script type="riot/tag" src="../tags/setting-page.tag"></script>
    <script type="riot/tag" src="../tags/mylist-page.tag"></script>
    <script type="riot/tag" src="../tags/bookmark-page.tag"></script>
    <script type="riot/tag" src="../tags/window-titlebar.tag"></script>
    <script>
        /* globals riot */
        const { ipcRenderer } = window.electron;
        const { IPC_CHANNEL } = window.IPC_CHANNEL;
        const { DataIpcRenderer } = window.DataIpc;
        var logger = window.logger; // eslint-disable-line
        let toast_wrapper = null;

        const obs = riot.observable();

        DataIpcRenderer.action("config", "set", 
            { key:"download.wait_time", value:10 }).then();

        obs.on("main-page:toastr", (args) => {
            const { type, title, message } = args;
            toast_wrapper[type](title, message);
        });

        ipcRenderer.on(IPC_CHANNEL.MAIN_TOASTR, (event, args)=>{
            const { type, title, message } = args;
            toast_wrapper[type](title, message);
        });

        window.onload = () => {
            toast_wrapper = new window.ToastWrapper();
        };

        if(process.env.NODE_ENV == "DEBUG"){
            const { NicoSearchMocks, NicoDownLoadMocks, NicoMylistMocks,
                setupNicoDownloadNock } = window.NicoMock;
            const nico_search_mock = new NicoSearchMocks();
            nico_search_mock.search();

            const video_fs = [];
            const lowq_set = new Set(["sm40"]);
            const smile_set = new Set(["sm20"]);
            const ids = ["sm10", "sm20", "sm30", "sm40", "sm50"];
            ids.forEach(id => {
                const dl_nock = new NicoDownLoadMocks(id, lowq_set, smile_set);
                setupNicoDownloadNock(dl_nock, { comment_delay:3000 });
                video_fs.push(dl_nock);
            });

            const mylist_mock = new NicoMylistMocks();
            mylist_mock.mylist({delay:2000});

            DataIpcRenderer.action("config", "set", 
                { key:"download.wait_time", value:1 }).then();

            obs.on("main-page:cancel-download", () => {
                video_fs.forEach(value => {
                    value.closeStream();
                });
            });
        }

        riot.mount("window-titlebar", {
            obs:obs, title:"test", window_name:"main"
        });
        
        // mount main-page in main.js
    </script>
</html>
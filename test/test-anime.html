<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <style type="text/css">
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            overflow: hidden;
        }
        #area{
            position: absolute;
            left: 100px;
            top: 50px;
            height: 80%;
            width: 60%;
            border: 1px solid #000000;
        }
        .comment{
            color: #000000;
            border: 1px solid #FF6600;           
        }
        .fix{
            float:left;
        }

        #play{
            width:50px;
        }        
    </style>
</head>

<body>
    <div id="timer">0</div>
    <button id="play", type=button data-func="play" onclick="play();">start</button>
    <input type="number" id="seek" /><button type=button onclick="seek();">seek</button>
    <div id="area"></div>
</body>

<script>
    // @ts-check
    var anime = require('animejs');
    var comment_elm = require("../comment");
    // var NicoComment = require("../nico_comment");
    var util = require("./test_comments");
    var CommentTimeLines = require("../app/js/comment_timeline");
  
    let areabyid = document.getElementById("area");
    let elm = document.createElement("div");
    elm.innerHTML = "fix textsssss";
    elm.classList.add("comment", "fix");
    elm.style.opacity = 0;
    areabyid.appendChild(elm);
    elm.style.position = "absolute";
    elm.setAttribute("data-delay", (1000).toString());

    let elm2= document.createElement("div");
    elm2.innerHTML = "fix text2";
    elm2.classList.add("comment", "fix");
    elm2.style.opacity = 0;
    areabyid.appendChild(elm2);
    elm2.style.position = "absolute";
    elm2.style.top = 50 + "px";
    elm2.setAttribute("data-delay", (3000).toString());  

    // let commnets = util.randomComments(5000, 1.5*1000);
    let commnets = util.sampleComments();
    commnets.sort((a, b) => {
        if (a.vpos < b.vpos) return -1;
        if (a.vpos > b.vpos) return 1;
        return 0;
    });
    console.log("last commnt time ms=", commnets[commnets.length-1].vpos*10);


    const parent_id = "area";
    const div_num = 2;
    const row_num = 12;
    const interval_ms = 100;
    const duration = 3000;

    let cutimer = 0;
    const get_time_func = ()=>{
        return cutimer;
    };
    let ctls = new CommentTimeLines(parent_id, div_num, row_num, interval_ms, get_time_func);

    ctls.create(duration, commnets);
    console.log("ctl_list.length=", ctls.timelines.length)

    let cutimer_id;
    
    let play = ()=>{   
        let btn = document.querySelector('#play');
        if(btn.getAttribute('data-func')=="play"){
            ctls.play();

            cutimer_id = setInterval(()=>{
                const target = document.getElementById("timer");
                target.textContent = cutimer;
                cutimer+=100;
            }, 100);;

            btn.textContent = "pause";
            btn.setAttribute('data-func', "pause");
        }else{
            ctls.pause();

            clearInterval(cutimer_id);
            btn.textContent = "play";
            btn.setAttribute('data-func', "play");
        }
    };

    let seek = ()=>{
        const target = document.getElementById("seek");
        const time_ms = parseInt(target.value);
        document.getElementById("timer").textContent = time_ms;
        cutimer = time_ms;
        ctls.seek(time_ms);
    };

    let reset = ()=>{
        cutimer = 0;
        document.getElementById("timer").textContent = cutimer;
        ctls.reset();
    }

    let timer;
    const timeout = 200;
    window.addEventListener('resize', () => {
        clearTimeout(timer);
        timer = setTimeout(() => {
            reset();
        }, timeout);
    });
</script>

</html>
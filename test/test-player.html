<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
</head>

<body>
    <input type="button" value="show" onClick=showPlayer()>
    <input type="button" value="data1" onClick=sendData1()>
    <input type="button" value="data2" onClick=sendData2()>
    <input type="button" value="read_db" onClick=readdb()>
    <input type="button" value="dump" onClick=dump()>
    <input type="button" value="read_json" onClick=read_json()>
</body>

<script>
    const remote = require('electron').remote
    const base_dir = remote.getGlobal('sharedObj').base_dir
    const ipc = require('electron').ipcRenderer
    const DB = require(`${base_dir}/app/js/db`).DB
    const SQLiteDB = require(`${base_dir}/app/js/sqlite_db`).SQLiteDB
    const serializer = require(`${base_dir}/app/js/serializer`)

    let sqlite_db = SQLiteDB()
    let db = new DB()

    let showPlayer = () => {
        ipc.send('request-show-player', null)
    }

    let sendData1 = () => {
        const commnets = db.findComments("sm1")
        const video_info = db.findVideoInfo("sm1")
        const data = {
            src: video_info.src,
            type: video_info.type,
            commnets: commnets
        }
        ipc.send('request-show-player', data)
    }
    let sendData2 = () => {
        let commnets = [
            { no: 0, vpos: 0, date: 1000, user_id: "aaa", text: "あああ" },
            { no: 1, vpos: 500, date: 1000, user_id: "aaa", text: "ああああああ" },
            { no: 2, vpos: 1000, date: 1000, user_id: "aaa", text: "あ" },
            { no: 3, vpos: 1500, date: 1000, user_id: "aaa", text: "あああああああああ" },
            { no: 4, vpos: 2000, date: 1000, user_id: "aaa", text: "あああ" },
            { no: 5, vpos: 25000, date: 1000, user_id: "aaa", text: "aaa" },
        ]
        const data = {
            src: "../mov/test.mp4",
            type: "video/mp4",
            commnets: commnets
        }
        ipc.send('request-show-player', data)
    }
    let readdb = () => {
        sqlite_db.init(`${base_dir}/test/sql/sample.db`)
        sqlite_db.read()

        db.setData(sqlite_db.get_dirpath(), sqlite_db.get_video())
    }
    let dump = () => {
        serializer.save(`${base_dir}/sample/dirpath.json`, sqlite_db.get_dirpath())
        serializer.save(`${base_dir}/sample/video.json`, sqlite_db.get_video())
    }
    let read_json = () => {
        const dirpath = serializer.load(`${base_dir}/sample/dirpath.json`)
        const video = serializer.load(`${base_dir}/sample/video.json`)
        db.setData(dirpath, video)
    }

</script>

</html>
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="../node_modules/riot/riot+compiler.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../app/css/app.css">
    <style type="text/css">
        #test-player-load-btn{
            height: 25px;
        }
        #test-player-page{
            height: calc(100% - 25px);
        }
    </style>
</head>

<body>
    <button id="test-player-load-btn"type="button" onclick="onclickLoad();">load</button>
    <player-page id="test-player-page"></player-page>
</body>

<script>
    const path = require("path");
    const fs = require("fs");
    const remote = require("electron").remote;
    const shared_obj = remote.getGlobal("sharedObj");
    var app_base_dir = shared_obj.base_dir;  // eslint-disable-line
    const test_dir = path.join(path.resolve(app_base_dir, ".."), "test");

    var riot = require("riot");  // eslint-disable-line
    var obs = riot.observable(); // eslint-disable-line

    require(`${app_base_dir}/tags/player-page.tag`);
    const reader = require(`${app_base_dir}/js/reader`);

    riot.mount("player-page");

    const onclickLoad = () => {
        // let commnets = []
        const comment_path = `${test_dir}/data/test1-comment.xml`;
        const xml = fs.readFileSync(comment_path, "utf-8");
        const commnets = reader.comment(xml);
        const data = {
            src: `${test_dir}/data/test1.mp4`,
            // src: `${video_src}/test.mp4`,
            type: "video/mp4",
            commnets: commnets
        };
        const video_tags = [
            { text: "タグ1", lock: true },
            { text: "タグ2", lock: true },
            { text: "タグ3", lock: true },
            { text: "タグ1", lock: false },
            { text: "タグ2", lock: false },
            { text: "タグ33333333333333333", lock: true },
            { text: "タグ33333333333333333", lock: false },
            { text: "タグ33333333333333333", lock: false }
        ];

        obs.trigger("on_set_player_state", "play"); 
        obs.trigger("receivedData", data); 
        obs.trigger("on_load_player_tags", video_tags);        
    };

    const timeout = 200;
    let timer;
    window.addEventListener("resize", () => {
        const window_size = {
            w: window.innerWidth, 
            h: window.innerHeight 
        };
        obs.trigger("on_resize_window", window_size);

        clearTimeout(timer);
        timer = setTimeout(() => {
            obs.trigger("resizeEndEvent", window_size);
        }, timeout);
    });

</script>

</html>
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script>
        window.jQuery = window.$ = require("jquery");
    </script>
    <link rel="stylesheet" type="text/css" href="../node_modules/slickgrid/slick.grid.css">
    <link rel="stylesheet" type="text/css" href="../node_modules/slickgrid/css/smoothness/jquery-ui-1.11.3.custom.css">
    <link rel="stylesheet" type="text/css" href="../node_modules/slickgrid/slick-default-theme.css">

    <style type="text/css">
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            /* overflow: hidden; */
            font-family: Verdana, Geneva, Tahoma, sans-serif; 
            font-size: 12px;
        }

        #cn {
            border: 1px solid #000000;
            width: 95%;
            height: 95%;
        }
        
        #myGrid {
            border: 1px solid #fa0303;
            width: 90%;
            height: 90%;
        }
        .slick-cell.active {
            border-style:initial;
            border: 1px solid transparent;
            border-right: 1px dotted silver;
            border-bottom-color: silver;
        }
        .slick-cell.selected {
            background-color: #6190cd6b;
        }
        .slick-cell.l2.r2 {
            white-space: normal;
        }
    </style>
</head>

<body>
    <div id="cn">
        <input type="search" class="library-search-input" onkeydown="keyDown(event);"/>
        <div id="myGrid"></div>
    </div>
</body>

<script>
    /* globals $ */
    const { remote } = require("electron");
    const { Menu, MenuItem } = remote;
    const { GridTable } = require("../app/js/gridtable");

    const columns = [
        {id: "thumb_img", name: "image", height:100, width: 130},
        {id: "id", name: "id",sortable: true},
        {id: "title", name: "Title", sortable: true},
        {id: "percentComplete", name: "% Complete", sortable: true},
        {id: "creation_date", name: "Creation date", sortable: true},
        {id: "pub_date", name: "Pub date", sortable: true},
        {id: "effortDriven", name: "Effort Driven", sortable: true}
    ];
    const options = {
        rowHeight: 100,
        _saveColumnWidth: true,
        _saveSort: true,
    };
    const grid_table = new GridTable("myGrid", columns, options);
    grid_table.init();
    grid_table.setFilter((column_id, value, word) => { 
        if (value.indexOf(word) != -1) {
            return true;
        }   
        return false; 
    });
    grid_table.onDblClick((e, data)=>{
        console.log("onDblClick data=", data);
    });

    const menu = new Menu();
    menu.append(new MenuItem({
        label: "Play", click() {
            const datas = grid_table.getSelectedDatas();
            console.log("lib context menu datas=", datas);
        }
    }));
    menu.append(new MenuItem({ type: "separator" }));
    menu.append(new MenuItem({ label: "MenuItem2", type: "checkbox", checked: true }));
   
    grid_table.onContextMenu((e)=>{
        menu.popup({window: remote.getCurrentWindow()});
    });    
    let data = [];
    for (let i = 0; i < 200; i++) {
        const id = i % 20;
        data[i] = {
            thumb_img: `./data/imgs/sm${id}.jpeg`,
            // id : `sm${id}`,
            id : i,
            // duration: "5 days",
            title: `test Task ${id}`,
            percentComplete: Math.round(Math.random() * 100),
            // start: "01/01/2009",
            creation_date: 1307213799000+i*2000,
            pub_date: 1307213799000+i*2000,
            effortDriven: (i % 5 == 0),
            tags:["tag1", "tag2"]
        };
    }
    grid_table.setData(data);

    const keyDown = (e) => {
        if(e.keyCode===13){
            const param = e.target.value;
            grid_table.filterData(param);
        }
    };

    // let mm=0;
    // setInterval(()=>{
    //     grid_table.scrollRow(mm);
    //     mm++;
    // }, 1000);

    const timeout = 200;
    let timer;
    window.addEventListener("resize", () => {
        clearTimeout(timer);
        timer = setTimeout(() => {
            const new_sizes = {
                height: $("#cn").height,
                width: $("#cn").width
            };
            grid_table.resize(new_sizes);
        }, timeout);
    });
</script>

</html>
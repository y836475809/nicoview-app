<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta 
            http-equiv="Content-Security-Policy" 
            content="
                script-src 'self' 'unsafe-inline' 'unsafe-eval';
                style-src 'self' 'unsafe-inline';
            "/>
        <link rel="stylesheet" type="text/css" href="../css/app.css">
        <link rel="stylesheet" type="text/css" href="../css/split-page.css">
        <style type="text/css">
        </style>
    </head>

    <body>
        <main-page></main-page>
    </body>
    <script src="../../node_modules/riot/riot+compiler.min.js"></script>
    <script type="riot/tag" src="../tags/main-page.tag"></script>
    <script type="riot/tag" src="../tags/listview.tag"></script>
    <script type="riot/tag" src="../tags/search-page-selector.tag"></script>
    <script type="riot/tag" src="../tags/pagination.tag"></script>
    <script type="riot/tag" src="../tags/modal-dialog.tag"></script>
    <script type="riot/tag" src="../tags/library-page.tag"></script>
    <script type="riot/tag" src="../tags/search-page.tag"></script>
    <script type="riot/tag" src="../tags/setting-download-schedule.tag"></script>
    <script type="riot/tag" src="../tags/download-page.tag"></script>
    <script type="riot/tag" src="../tags/play-history-page.tag"></script>
    <script type="riot/tag" src="../tags/setting-page.tag"></script>
    <script type="riot/tag" src="../tags/mylist-page.tag"></script>
    <script type="riot/tag" src="../tags/bookmark-page.tag"></script>
    <script type="riot/tag" src="../tags/play-stack-page.tag"></script>
    <script type="riot/tag" src="../tags/open-video-form.tag"></script>
    <script>
        /* globals riot */
        const { ipcRenderer, remote } = window.electron;
        const { IPC_CHANNEL } = window.IPC_CHANNEL;
        const { IPCClient } = window.IPC;
        var { logger } = window.logger; // eslint-disable-line
        let toast_wrapper = null;

        const obs = riot.observable();

        IPCClient.request("config", "set", 
            { key:"download.wait_time", value:10 }).then();

        obs.on("main-page:toastr", (args) => {
            const { type, title, message } = args;
            toast_wrapper[type](title, message);
        });

        ipcRenderer.on(IPC_CHANNEL.MAIN_TOASTR, (event, args)=>{
            const { type, title, message } = args;
            toast_wrapper[type](title, message);
        });

        ipcRenderer.on(IPC_CHANNEL.MAIN_HTML_LOADED, (event)=>{
            riot.mount("main-page", {obs});
        });

        window.onload = () => {
            const { ToastWrapper } = window.ToastWrapper;
            toast_wrapper = new ToastWrapper();
            window.document.title = `${remote.app.name} ${remote.app.getVersion()}`;
        };

        if(process.env.NODE_ENV == "DEBUG"){
            const { NicoMockServer } = window.NicoMockServer;
            
            const nico_mock_server = new NicoMockServer();
            nico_mock_server.create();
            nico_mock_server.listen();
            window.addEventListener("beforeunload", (event) => {
                nico_mock_server.close();
            });

            IPCClient.request("config", "set", 
                { key:"download.wait_time", value:1 }).then();
        }
    </script>
</html>
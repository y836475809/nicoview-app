<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Test player viewinfo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
            window.jQuery = window.$ = require("jquery");
    </script>
    <script src="../node_modules/riot/riot+compiler.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../app/css/app.css">

    <style type="text/css">
        .test-button{
            height: 25px;
        }
        .test-player-main-page{
            height: calc(100% - 25px);
        }
    </style>

</head>

<body>
    <div class="test-button">
        <button type="button" onclick="onclickLoad();">load</button>
        <button type="button" onclick="onclickLoad2();">load comment</button>
        <button type="button" onclick="onclickLoad3();">watch dmc</button>
        <button type="button" onclick="onclickLoad4();">watch smile</button>
    </div>    
    <player-main-page ref="pvi" class="test-player-main-page"></player-main-page>
</body>

<script>
    //require("gsap")はrequire("riot")の前でないと以下のエラーが出る
    //Uncaught DOMException: Failed to execute 'createElement' on 'Document': The tag name provided ('http://www.w3.org/2000/svg') is not a valid name.
    var { TweenMax, TimelineMax } = require("gsap"); // eslint-disable-line
    const path = require("path");
    const fs = require("fs");
    const remote = require("electron").remote;
    const shared_obj = remote.getGlobal("sharedObj");
    var app_base_dir = shared_obj.base_dir;  // eslint-disable-line
    const test_dir = path.join(path.resolve(app_base_dir, ".."), "test");

    var riot = require("riot");  // eslint-disable-line
    var obs = riot.observable(); // eslint-disable-line
    
    const reader = require(`${app_base_dir}/js/reader`);
    require(`${app_base_dir}/tags/player-main-page`);
    riot.mount("player-main-page");    

    const onclickLoad = () => {
        const comment_path = `${test_dir}/data/test1-comment.xml`;
        const xml = fs.readFileSync(comment_path, "utf-8");
        const comments = reader.comment(xml);
        const video_data = {
            src: `${test_dir}/data/test1.mp4`,
            type: "video/mp4",
            comments: comments
        };
        const viewinfo = {
            thumb_info: {
                video: {
                    video_id: "sm100000",
                    title: "test sm100000",
                    description: "前：<a href=\"https://www.nicovideo.jp/watch/sm10\" class=\"watch\">sm10</a>"
                            + "------------------動画-------------------- <br>"
                            + "---<br>--<br>--<br><br>----<br>---<br>--<br>--",
                    thumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    largeThumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    postedDateTime: "2017-07-07T18:30:00+09:00",
                    duration: "10:00",
                    viewCount: 1000, 
                    mylistCount: 100, 
                    video_type: "mp4",
                },
                thread: {
                    commentCount: 2000
                },
                tags: [
                    { id: 1, name: "タグ1", isLocked: true },
                    { id: 2, name: "タグ2", isLocked: true },
                    { id: 3, name: "タグ3", isLocked: false }
                ],
                owner: {
                    id: "1234567",
                    nickname: "abcdefg",
                    iconURL: `${test_dir}/data/user_icon.jpg` //50x50
                }
            },
            comments: comments
        };
        
        obs.trigger("request-send-video-data", {video_data, viewinfo}); 
    };
    const onclickLoad2 = () => {
        let comments = [];
        const nn = 5000;
        for (let index = 0; index < nn; index++) {
            comments.push({
                no: index + 1,
                vpos: 50 * index,
                post_date: 1332592373506 + index*100,
                user_id: "AAA",
                mail: "ue",
                text: "------------------text1------------------------"
            });
        }
        obs.trigger("on_change_viewinfo",{
            thumb_info: {
                video: {
                    video_id: "sm100000",
                    title: "test sm100000",
                    description: "--------- ---------動画----- ---------------",
                    thumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    largeThumbnailURL: `${test_dir}/data/sample.jpeg`, //130x100
                    postedDateTime: "2017-07-07T18:30:00+09:00",
                    duration: "10:00",
                    viewCount: 1000, 
                    mylistCount: 100, 
                    video_type: "mp4",
                },
                thread: {
                    commentCount: 2000
                },
                tags: [
                    { id: 1, name: "タグ1", isLocked: true },
                    { id: 2, name: "タグ2", isLocked: true },
                ],
                owner: {
                    id: "1234567",
                    nickname: "abcdefg",
                    iconURL: `${test_dir}/data/user_icon.jpg` //50x50
                }
            },
            comments: comments
        }); 
    };

    const onclickLoad3 = () => {
        const video_id = "sm33851481"; //"sm32951089";
        obs.trigger("request-send-videoid", video_id); 
    };
    const onclickLoad4 = () => {
        const video_id = "sm29316071";
        obs.trigger("request-send-videoid", video_id); 
    };
</script>

</html>